[agent]
  interval = "5s"
  round_interval = true
  debug = true
  logfile = ""

[[inputs.mqtt_consumer]]
  servers   = ["ssl://mosquitto:8883"]
  topics    = ["sensors/#"] 
  client_id = "telegraf_bridge"
  qos       = 1

  # mTLS
  tls_ca   = "/etc/telegraf/ssl/mqtt_ca.crt"
  tls_cert = "/etc/telegraf/ssl/telegraf.crt"
  tls_key  = "/etc/telegraf/ssl/telegraf.key"

  # JSON â†’ fields/tags
  data_format = "json"
  tag_keys    = ["sensor_id"]
  name_override = "electrolyser"

# TEMP: echo parsed metrics to stdout as line protocol
[[outputs.file]]
  files = ["stdout"]
  data_format = "influx"
  tagexclude = ["host"]

# Real output
[[outputs.influxdb_v2]]
  urls = ["${INFLUXDB_URL}"]
  token = "${INFLUXDB_TOKEN}"
  organization = "${INFLUXDB_ORG}"
  bucket = "${INFLUXDB_BUCKET}"
